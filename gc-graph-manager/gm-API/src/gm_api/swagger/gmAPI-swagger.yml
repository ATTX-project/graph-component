
#ATTX GM-API specification
swagger: '2.0'

info:
  version: "0.2"
  title: ATTX GM API
  description: ATTX GM internal  API for mapping the source data against a RML mapping configuration and communication between Graph Manager the Workflow Component and the Graph Store.
  contact:
    name: "ATTX project"
    url: http://helsinki.fi/library
  license:
    name: "MIT"

tags:
- name: "gmAPI"
  description: "Internal GM-API for graph manager"
  externalDocs:
    description: "just use it"
    url: http://helsinki.fi/library

schemes:
- "http"

basePath: /api/0.2/

paths:
  /map/{mapID}:
    get:
      tags:
        - "gmAPI"
      description: "Get status of the mapping job."
      produces:
      - "application/json"
      parameters:
        - in: path
          name: mapID
          description: "Fetch map with a specific ID."
          required: true
          type: integer
          format: int64
      responses:
        200:
          description: "Successful response."
          schema:
            $ref: '#/definitions/MapResult'
        410:
          description: "Map Gone."
    delete:
      description: "Delete map with a certain ID."
      parameters:
        - in: path
          name: mapID
          description: Fetch map with a specific ID.
          required: true
          type: integer
          format: int64
      responses:
        200:
          description: OK

  /map:
    post:
      tags:
        - "gmAPI"
      parameters:
        - name: mapping
          in: body
          description: "Mapping object to pass to the Graph Manager API. Triggering the creation of a index and possible handling of aliases between indexes."
          required: true
          schema:
            $ref: '#/definitions/Map'
      produces:
          - "application/json"
      responses:
        202:
          description: "Accepted."
          schema:
            $ref: '#/definitions/MapResult'
        405:
          description: "Invalid Input."

  /clusterids:
    post:
     tags:
        - "gmAPI"
     description: "Initiates ID clustering"
     responses:
        202:
          description: "Accepted."
  /links:
    get:
     tags:
        - "gmAPI"
     description: Get the links in the Graph Store
     responses:
        200:
          description: "Successful response."
    post:
      tags:
        - "gmAPI"
      parameters:
        - name: linking
          in: body
          description: "Linking between Working Data Graphs based on link object."
          required: true
          schema:
            $ref: '#/definitions/Link'
      responses:
        202:
          description: "Accepted."
        405:
          description: "Invalid Input."
definitions:
  Map:
    allOf:
      - required:
        - plugin
        - mapping
        - targetEndpoint
        - sourceGraphs
        properties:
          plugin:
            type: array
            description: "list of plugin names/IDs for different mappers"
            items:
              type: string
          targetEndpoint:
            type: string
          mapping:
            type: object
          sourceGraphs:
            type: array
            items:
              type: string
          format:
            type: string
  MapResult:
    required:
    - id
    - status
    properties:
      id:
        type: integer
        format: int64
      status:
        type: string
  Link:
    required:
    - inputGraph
    - outputGraph
    properties:
      inputGraph:
        type: string
      outputGraph:
        type: string
          
